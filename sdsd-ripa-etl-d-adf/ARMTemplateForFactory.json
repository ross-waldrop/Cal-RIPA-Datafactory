{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "sdsd-ripa-etl-d-adf"
		},
		"LS_COSMOSDB_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'LS_COSMOSDB'"
		},
		"LS_ADB_SPARK_CLUSTER_properties_typeProperties_existingClusterId": {
			"type": "string",
			"defaultValue": "0707-182743-y8rouvc6"
		},
		"LS_ADLS_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://sdsdripaetldsa.dfs.core.usgovcloudapi.net/"
		},
		"LS_ADLS_properties_typeProperties_tenant": {
			"type": "string",
			"defaultValue": "a44e5271-a297-4daf-a3a9-f90a3146f3f5"
		},
		"LS_ADLS_properties_typeProperties_servicePrincipalId": {
			"type": "string",
			"defaultValue": "498da49a-984d-42b0-a96f-e42a0bce03d1"
		},
		"LS_ASQL_SQL_AUTH_properties_typeProperties_connectionString_secretName": {
			"type": "string",
			"defaultValue": "@linkedService().LS_ASQL_SQL_AUTH_CONN_SECRET"
		},
		"LS_KEY_VAULT_properties_typeProperties_baseUrl": {
			"type": "string",
			"defaultValue": "https://sdsd-ripa-etl-d-kv.vault.usgovcloudapi.net/"
		},
		"Daily Run_properties_PL_SOURCE_2_AAS_parameters_EnableNotifications": {
			"type": "string",
			"defaultValue": "true"
		},
		"Daily Run_properties_PL_SOURCE_2_AAS_parameters_SendEmailNotificationAddress": {
			"type": "string",
			"defaultValue": "CssaRipaPbiSupport@sdsheriff.gov"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/PL_LOGMSG_AND_SENDEMAIL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Log execution status and send an email to admins",
				"activities": [
					{
						"name": "ACT_ITRC_IF_ERROR",
						"description": "This is an error, please log it",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@pipeline().parameters.IsError",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": {
													"value": "@pipeline().parameters.Subject",
													"type": "Expression"
												},
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "@concat('Error message: ', pipeline().parameters.Message)",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "true",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": "N/A",
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "false",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": "@pipeline().parameters.Etl_DB_Conn_Secret"
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_ITRC_IF_SEND_EMAIL",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_IF_ERROR",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@pipeline().parameters.EmailEnabled",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_SENDEMAIL",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_SENDEMAIL",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": {
												"value": "@pipeline().parameters.IsError",
												"type": "Expression"
											},
											"EmailTo": {
												"value": "@pipeline().parameters.EmailTo",
												"type": "Expression"
											},
											"Subject": {
												"value": "@pipeline().parameters.Subject",
												"type": "Expression"
											},
											"Message": {
												"value": "@pipeline().parameters.Message",
												"type": "Expression"
											},
											"Importance": {
												"value": "@pipeline().parameters.Importance",
												"type": "Expression"
											},
											"EmailEnabled": {
												"value": "@pipeline().parameters.EmailEnabled",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().parameters.PipelineName",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().parameters.PipelineRunID",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().parameters.DataFactoryName",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@pipeline().parameters.Etl_DB_Conn_Secret",
												"type": "Expression"
											},
											"Color": {
												"value": "@pipeline().parameters.Color",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"IsError": {
						"type": "bool"
					},
					"EmailTo": {
						"type": "string"
					},
					"Subject": {
						"type": "string"
					},
					"Message": {
						"type": "string"
					},
					"Importance": {
						"type": "string"
					},
					"EmailEnabled": {
						"type": "bool"
					},
					"PipelineName": {
						"type": "string"
					},
					"PipelineRunID": {
						"type": "string"
					},
					"DataFactoryName": {
						"type": "string"
					},
					"Etl_DB_Conn_Secret": {
						"type": "string"
					},
					"Color": {
						"type": "string"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					}
				},
				"folder": {
					"name": "000_LOGS_AND_EMAILS"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:45Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_SENDEMAIL')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_LOGMSG_AND_SENDEMAIL_ITEM')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Log execution status and send an email to admins",
				"activities": [
					{
						"name": "ACT_ITRC_IF_ERROR",
						"description": "This is an error, please log it",
						"type": "IfCondition",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@pipeline().parameters.IsError",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": {
													"value": "@pipeline().parameters.Subject",
													"type": "Expression"
												},
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "@concat('Error message: ', pipeline().parameters.Message)",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "true",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@pipeline().parameters.TableName",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@pipeline().parameters.TableSchema",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": {
													"value": "@pipeline().parameters.RowsCopied",
													"type": "Expression"
												},
												"type": "Int32"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": "@pipeline().parameters.Etl_DB_Conn_Secret"
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_ITRC_IF_SEND_EMAIL",
						"type": "IfCondition",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_IF_ERROR",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"expression": {
								"value": "@pipeline().parameters.EmailEnabled",
								"type": "Expression"
							},
							"ifTrueActivities": [
								{
									"name": "PL_SENDEMAIL",
									"type": "ExecutePipeline",
									"dependsOn": [],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_SENDEMAIL",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": {
												"value": "@pipeline().parameters.IsError",
												"type": "Expression"
											},
											"EmailTo": {
												"value": "@pipeline().parameters.EmailTo",
												"type": "Expression"
											},
											"Subject": {
												"value": "@pipeline().parameters.Subject",
												"type": "Expression"
											},
											"Message": {
												"value": "@pipeline().parameters.Message",
												"type": "Expression"
											},
											"Importance": {
												"value": "@pipeline().parameters.Importance",
												"type": "Expression"
											},
											"EmailEnabled": {
												"value": "@pipeline().parameters.EmailEnabled",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().parameters.PipelineName",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().parameters.PipelineRunID",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": {
												"value": "@pipeline().parameters.Color",
												"type": "Expression"
											},
											"TableSchema": {
												"value": "@pipeline().parameters.TableSchema",
												"type": "Expression"
											},
											"TableName": {
												"value": "@pipeline().parameters.TableName",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"IsError": {
						"type": "bool"
					},
					"EmailTo": {
						"type": "string"
					},
					"Subject": {
						"type": "string"
					},
					"Message": {
						"type": "string"
					},
					"Importance": {
						"type": "string"
					},
					"EmailEnabled": {
						"type": "bool"
					},
					"PipelineName": {
						"type": "string"
					},
					"PipelineRunID": {
						"type": "string"
					},
					"DataFactoryName": {
						"type": "string"
					},
					"Etl_DB_Conn_Secret": {
						"type": "string"
					},
					"Color": {
						"type": "string"
					},
					"TableSchema": {
						"type": "string"
					},
					"TableName": {
						"type": "string"
					},
					"RowsCopied": {
						"type": "int"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					}
				},
				"folder": {
					"name": "000_LOGS_AND_EMAILS"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:46Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_SENDEMAIL')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_MDW_2_ASQL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "run the correct dbr notebooks to promote raw data to staget data",
				"activities": [
					{
						"name": "ACT_GEN_LKP_TABLES",
						"description": "Lookup the tables to move from adls to asql in our metadata table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select * from adf.DataSource where mdw2asql = 1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "IS_ERROR",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "Notify admins raw2stage nb failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_ADLS_2_ASQL",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('FAILURE: Copy data failure -  ', pipeline().Pipeline, ' ',item().datasourcename, '.', item().databasetablename)",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('Copy data activity - ',   item().datasourcename, '/', item().databasetablename, ' Error Code:', activity('ACT_MT_COPY_ADLS_2_ASQL').error.errorCode, ' - Message:', activity('ACT_MT_COPY_ADLS_2_ASQL').error.message)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "@{item().Datasourcename}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().Databasetablename}",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Copy",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Started copying data from ADLS to ASQL for table @{item().DataSourceName}.@{item().DatabaseTableName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().DatalakeEntityName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@{item().DataSourceName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_END",
									"description": "",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_ADLS_2_ASQL",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Copy",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished copying data from ADLS to ASQL for table @{item().DataSourceName}.@{item().DatabaseTableName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().DatalakeEntityName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@{item().DataSourceName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_MT_COPY_ADLS_2_ASQL",
									"description": "Copy data from adls mdw container to azure sql",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_TRUNCATE_TABLE",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.03:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "ParquetSource",
											"storeSettings": {
												"type": "AzureBlobFSReadSettings",
												"recursive": true,
												"wildcardFolderPath": {
													"value": "@item().DatalakePath",
													"type": "Expression"
												},
												"wildcardFileName": "*.parquet",
												"enablePartitionDiscovery": false
											}
										},
										"sink": {
											"type": "AzureSqlSink",
											"tableOption": "autoCreate",
											"disableMetricsCollection": false
										},
										"enableStaging": false,
										"parallelCopies": 5,
										"dataIntegrationUnits": 64
									},
									"inputs": [
										{
											"referenceName": "DS_ADLS_MDW",
											"type": "DatasetReference",
											"parameters": {
												"SchemaName": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"FileName": {
													"value": "@item().DataLakeEntityName",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DS_ASQL_SQL_AUTH",
											"type": "DatasetReference",
											"parameters": {
												"DS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string",
												"DS_DB_SCHEMA_NAME": "@{item().DataSourceName}",
												"DS_DB_TABLE_NAME": "@{item().DatalakeEntityName}"
											}
										}
									]
								},
								{
									"name": "ACT_GEN_SPRC_TRUNCATE_TABLE",
									"description": "Truncate asql table",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspTruncateTable]",
										"storedProcedureParameters": {
											"DatabaseSchemaName": {
												"value": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"type": "String"
											},
											"DatabaseTableName": {
												"value": {
													"value": "@item().DatabaseTableName",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('FAILURE - ' , pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('error code:',\nactivity('ACT_GEN_LKP_TABLES').output.error.errorCode\n, ' - Message: ',\nactivity('ACT_GEN_LKP_TABLES').output.error.message\n)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('SUCCESS - ', pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "MDW2ASQL Completed",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "IS_ERROR",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start mdw_2_asql pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "Start of MDW_2_ASQL",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started copying data from ADLS to ASQL",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of mdw_2_asql pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "End of MDW_2_ASQL",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished copying data from ADLS to ASQL",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": true
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "brian.rotich@insight.com"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"IS_ERROR": {
						"type": "Boolean"
					}
				},
				"folder": {
					"name": "400_MDW_2_ASQL"
				},
				"annotations": [],
				"lastPublishTime": "2021-09-14T14:26:04Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]",
				"[concat(variables('factoryId'), '/datasets/DS_ADLS_MDW')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_PROCESS_AAS_RIPAMODEL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_LOGIC_APP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_LOGIC_APP').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"activities": [
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
									"description": "Notify admins that the web activity failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_GEN_WEB_PROCESS_AAS_PNLMODEL",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('FAILURE - ' , pipeline().Pipeline)",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('error code:',\nactivity('ACT_GEN_WEB_PROCESS_AAS_PNLMODEL').output.error.errorCode\n, ' - Message: ',\nactivity('ACT_GEN_WEB_PROCESS_AAS_PNLMODEL').output.error.message\n)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": "N/A",
											"Color": "Red"
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
									"description": "email success notification",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_PL_END",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": false,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('SUCCESS - ', pipeline().Pipeline)",
												"type": "Expression"
											},
											"Message": {
												"value": "AAS Process complete",
												"type": "Expression"
											},
											"Importance": "Low",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Color": "Green"
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start process aas pipeline",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Start of PROCESS_AAS",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started processing AAS",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": "N/A",
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "false",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string"
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_PL_END",
									"description": "end of aas processing",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_GEN_WEB_PROCESS_AAS_PNLMODEL",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "End of PL_PROCESS_AAS",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Finished processing AAS",
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": "N/A",
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "false",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string"
										}
									}
								},
								{
									"name": "ACT_GEN_WEB_PROCESS_AAS_PNLMODEL",
									"type": "WebActivity",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@item().LogicAppURL",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {},
										"body": {
											"message": "process aas"
										}
									}
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ERROR_FLG",
										"value": "true"
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_LKP_LOGIC_APP",
						"description": "Lookup the tables to move from adls to asql in our metadata table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select * from adf.LogicAppURL where logicAppType = 'processcube'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "sec-mdw-db-connection-string",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "LogicAppURL"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start mdw_2_asql pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "Start of cube Processing",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started copying data from ADLS to ASQL",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string"
							}
						}
					},
					{
						"name": "ACT_EXECUTE_CREATE_XMLA_FILE",
						"description": "This activity will execute a Databricks notebook that will create a XMLA file for the Security-Readers role in the AAS ripamodel",
						"type": "DatabricksNotebook",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebookPath": "/data_engineering/AAS/create_xmla_file"
						},
						"linkedServiceName": {
							"referenceName": "LS_ADB_SPARK_CLUSTER",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "ACT_CALL_RUN_AAS_SEC_READERS_WEBHOOK",
						"description": "This webhook call will run the Run_AAS_Sec_Readers (sdsd-ripa-etl-d-aaa/Run_AAS_Sec_Readers) runbook (powershell script) which will execute the created XMLA file.",
						"type": "WebHook",
						"dependsOn": [
							{
								"activity": "ACT_EXECUTE_CREATE_XMLA_FILE",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_SET_WEBHOOK_VARIABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@variables('AAS_SEC_READERS_WEBHOOK')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {},
							"body": {
								"message": "Execute Run_AAS_Sec_Readers"
							},
							"timeout": "00:10:00",
							"reportStatusOnCallBack": true
						}
					},
					{
						"name": "ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK",
						"description": "Lookup Webhook from adf.LogicAppURL table.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select * from adf.LogicAppURL where logicAppType = 'AAS_Sec_Readers'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string",
									"DS_DB_SCHEMA_NAME": "adf",
									"DS_DB_TABLE_NAME": "LogicAppURL"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "ACT_SET_WEBHOOK_VARIABLE",
						"description": "Assign webhook url to variable",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "AAS_SEC_READERS_WEBHOOK",
							"value": {
								"value": "@activity('ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK').output.firstRow.LogicAppUrl",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "string",
						"defaultValue": "true"
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					}
				},
				"variables": {
					"ERROR_FLG": {
						"type": "String"
					},
					"AAS_SEC_READERS_WEBHOOK": {
						"type": "String"
					}
				},
				"folder": {
					"name": "500_PROCESS_AAS"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:53Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_RAW_2_STAGE')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "run the correct dbr notebooks to promote raw data to staget data",
				"activities": [
					{
						"name": "ACT_GEN_LKP_TABLES",
						"description": "Lookup the raw2stage notebooks using the auditing metadatatable",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select * from adf.DataSource where Raw2stage = 1 AND datasourcetype NOT LIKE 'cosmosdb'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "admin",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "ACT_ADB_NB_RAW2STAGE",
									"description": "Run RAW2STAGE notebook",
									"type": "DatabricksNotebook",
									"dependsOn": [
										{
											"activity": "ACT_WAIT",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "1.10:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"notebookPath": {
											"value": "@{pipeline().parameters.NotebookPath}\n",
											"type": "Expression"
										},
										"baseParameters": {
											"deltatable_path": {
												"value": "/@{item().DataLakePath}/@{item().DatabaseTableName}.delta",
												"type": "Expression"
											},
											"isincremental": {
												"value": "@if(equals(item().IsIncremental, True), '1', '0')",
												"type": "Expression"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ADB_SPARK_CLUSTER",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "IS_ERROR",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "Notify admins raw2stage nb failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NB_RAW2STAGE",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('FAILURE: Notebook Failure -  ', pipeline().Pipeline, ' ',item().datasourcename, '.', item().databasetablename)",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('Notebook - ', pipeline().parameters.NotebookPath,   item().datasourcename, '/', item().databasetablename, ' Error Code:', activity('ACT_ADB_NB_RAW2STAGE').error.errorCode, ' - Message:', activity('ACT_ADB_NB_RAW2STAGE').error.message)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "stage_@{item().Datasourcename}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().Databasetablename}",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_WAIT",
									"description": "randomly wait so that we don't overwhelm the databricks scheduling queue",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ADB_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@rand(1,10)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ADB_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started transforming table from raw to stage",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().DatabaseTableName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "stage_@{item().DataSourceName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ADB_ITEM_END",
									"description": "",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NB_RAW2STAGE",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished executing ADB Notebook to transform @{item().DataSourceName}/@{item().DatabaseTableName} to staging",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().Databasetablename}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "stage_@{item().DataSourceName}",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "Notify admins that the lookup of the raw2stage notebooks failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('Lookup Failure - ' , pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('error code:',\nactivity('ACT_GEN_LKP_TABLES').output.error.errorCode\n, ' - Message: ',\nactivity('ACT_GEN_LKP_TABLES').output.error.message\n)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('Success - ', pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "Raw2Stage completed",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "IS_ERROR",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "Start of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "End of Raw_2_Stage",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": true
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					},
					"NotebookPath": {
						"type": "string",
						"defaultValue": "/data_engineering/Raw2Stage/Raw2Stage"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"IS_ERROR": {
						"type": "Boolean"
					}
				},
				"folder": {
					"name": "200_RAW_2_STAGE"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:49Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_RAW_2_STAGE_COSMOSDB')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "run the correct dbr notebooks to promote raw data to staget data",
				"activities": [
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "Notify admins that the lookup of the raw2stage notebooks failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_RAW_2_STAGE_COSMOSDB",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('Lookup Failure - ' , pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('Message: '\n, activity('ACT_RAW_2_STAGE_COSMOSDB').output.runError\n)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('Success - ', pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "Raw2Stage completed",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "IS_ERROR",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "Start of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_RAW_2_STAGE_COSMOSDB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "End of Raw_2_Stage",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_RAW_2_STAGE_COSMOSDB",
						"type": "DatabricksNotebook",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebookPath": {
								"value": "@{pipeline().parameters.NotebookPath}\n",
								"type": "Expression"
							},
							"baseParameters": {
								"deltatable_path": "/ripastops/main/"
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ADB_SPARK_CLUSTER",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": false
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					},
					"NotebookPath": {
						"type": "string",
						"defaultValue": "/data_engineering/Raw2Stage/Raw2Stage_cosmosdb"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"IS_ERROR": {
						"type": "Boolean"
					}
				},
				"folder": {
					"name": "200_RAW_2_STAGE"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:50Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_SENDEMAIL')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "Log execution status and send an email to admins",
				"activities": [
					{
						"name": "ACT_GEN_LKP_LOGIC_APP",
						"description": "Lookup the raw2stage notebooks using the auditing metadatatable",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select *\nfrom adf.LogicAppURL\nwhere logicapptype = 'email'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "LogicAppURL"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_LOGIC_APP",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_LOGIC_APP').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 20,
							"activities": [
								{
									"name": "ACT_GEN_WEB_CALL_LOGIC_APP",
									"description": "This logic app sends an email to admins if enabled",
									"type": "WebActivity",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"url": {
											"value": "@item().LogicAppURL",
											"type": "Expression"
										},
										"method": "POST",
										"headers": {
											"Content-Type": "application/json"
										},
										"body": {
											"value": "{ \n\"DataFactoryName\": \"@{pipeline().DataFactory}\", \n\"EmailTo\":\"@{pipeline().parameters.EmailTo}\", \n\"Message\":\"@{pipeline().parameters.Message}\", \"PipelineName\":\"@{pipeline().parameters.PipelineName}\", \"PipelineRunID\":\"@{pipeline().parameters.PipelineRunID}\", \"Subject\":\"@{pipeline().parameters.Subject}\", \"Importance\":\"@{pipeline().parameters.Importance}\",\n\"Color\":\"@{pipeline().parameters.Color}\" \n}",
											"type": "Expression"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"IsError": {
						"type": "bool"
					},
					"EmailTo": {
						"type": "string"
					},
					"Subject": {
						"type": "string"
					},
					"Message": {
						"type": "string"
					},
					"Importance": {
						"type": "string"
					},
					"EmailEnabled": {
						"type": "bool"
					},
					"PipelineName": {
						"type": "string"
					},
					"PipelineRunID": {
						"type": "string"
					},
					"DataFactoryName": {
						"type": "string"
					},
					"Etl_DB_Conn_Secret": {
						"type": "string"
					},
					"Color": {
						"type": "string"
					},
					"TableSchema": {
						"type": "string"
					},
					"TableName": {
						"type": "string"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					}
				},
				"folder": {
					"name": "000_LOGS_AND_EMAILS"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:44Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_SOURCE_2_AAS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "PL_RAW_2_STAGE_COSMOSDB",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_SOURCE_2_RAW_CSV",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "PL_SOURCE_2_RAW_COSMOSDB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_RAW_2_STAGE_COSMOSDB",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"NotebookPath": "/data_engineering/Raw2Stage/Raw2Stage_cosmosdb"
							}
						}
					},
					{
						"name": "PL_MDW_2_ASQL",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_STAGE_2_MDW",
								"dependencyConditions": [
									"Completed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_MDW_2_ASQL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "PL_ASQL_2_AAS_RIPAMODEL",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_MDW_2_ASQL",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_PROCESS_AAS_RIPAMODEL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "PL_SOURCE_2_RAW_COSMOSDB",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SOURCE_2_RAW_COSMOSDB",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"DataSourceName": "-",
								"DataSourceType": "cosmosdb",
								"DataSourceID": "NULL"
							}
						}
					},
					{
						"name": "PL_STAGE_2_MDW",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_RAW_2_STAGE_COSMOSDB",
								"dependencyConditions": [
									"Completed"
								]
							},
							{
								"activity": "PL_RAW_2_STAGE",
								"dependencyConditions": [
									"Completed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_STAGE_2_MDW_PARENT",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "PL_RAW_2_STAGE",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "PL_SOURCE_2_RAW_CSV",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "PL_SOURCE_2_RAW_COSMOSDB",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_RAW_2_STAGE",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"NotebookPath": "/data_engineering/Raw2Stage/Raw2Stage"
							}
						}
					},
					{
						"name": "PL_SOURCE_2_RAW_CSV",
						"type": "ExecutePipeline",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_SOURCE_2_RAW_CSV",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"EnableNotifications": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"SendEmailNotificationAddress": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"NotebookPath": "/data_engineering/Source2Raw/Source2RawFullLoad",
								"DataSourceName": "static",
								"DataSourceType": "csv",
								"DataSourceID": "NULL"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "string",
						"defaultValue": "true"
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					}
				},
				"folder": {
					"name": "001_SCHEDULED_PIPELINES"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:54Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/PL_RAW_2_STAGE_COSMOSDB')]",
				"[concat(variables('factoryId'), '/pipelines/PL_MDW_2_ASQL')]",
				"[concat(variables('factoryId'), '/pipelines/PL_PROCESS_AAS_RIPAMODEL')]",
				"[concat(variables('factoryId'), '/pipelines/PL_SOURCE_2_RAW_COSMOSDB')]",
				"[concat(variables('factoryId'), '/pipelines/PL_STAGE_2_MDW_PARENT')]",
				"[concat(variables('factoryId'), '/pipelines/PL_RAW_2_STAGE')]",
				"[concat(variables('factoryId'), '/pipelines/PL_SOURCE_2_RAW_CSV')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_SOURCE_2_RAW_COSMOSDB')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "This pipeline will truncate all tables and load all of the DBO tables from the ODS into HIVE",
				"activities": [
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start of source_2_raw pipeline. Stored procedure that logs it.",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "Start of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started copying data to delta tables",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_LKP_TABLES",
						"description": "lookup tables that are enabled in metadata table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[adf].[uspGetTableListing]",
								"storedProcedureParameters": {
									"DataSourceName": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceName",
											"type": "Expression"
										}
									},
									"DataSourceType": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceType",
											"type": "Expression"
										}
									},
									"Incremental": {
										"type": "String",
										"value": "0"
									},
									"DataSourceID": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "iterate through each table and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SET_VAR_UTC_STAMP",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_GEN_SET_VAR_LOCAL_TIME",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
									"description": "copy tables to raw parquet",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.06:00:00",
										"retry": 2,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "CosmosDbSqlApiSource",
											"preferredRegions": []
										},
										"sink": {
											"type": "JsonSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "JsonWriteSettings"
											}
										},
										"enableStaging": false,
										"parallelCopies": 5,
										"validateDataConsistency": false
									},
									"inputs": [
										{
											"referenceName": "DS_COSMOSDB",
											"type": "DatasetReference",
											"parameters": {
												"DS_DATABASETABLENAME": {
													"value": "@item().databasetablename",
													"type": "Expression"
												},
												"DS_COSMOS_DB_ACCT_URI": {
													"value": "@item().DatabaseServerName",
													"type": "Expression"
												},
												"DS_COSMOS_ACCESS_KEY_SEC": {
													"value": "@item().DatabaseUserNamePasswordSecret",
													"type": "Expression"
												},
												"DS_COSMOS_DB_NAME": {
													"value": "@item().DatabaseName",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DS_ADLS_RAW_JSON",
											"type": "DatasetReference",
											"parameters": {
												"DatasourceName": {
													"value": "@item().DatabaseName",
													"type": "Expression"
												},
												"FileName": {
													"value": "@{item().DataSourceName}-@{item().DatabaseTableName}-@{variables('UTC_TIME')}.json",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_2",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ERROR_FLG",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_SPRC_UPDATE_LAST_EXECUTION_DATE",
									"description": "log full load finish datetime for the source table ",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NOTE_JSON_2_PARQUET",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspUpdateLastExecutionDate]",
										"storedProcedureParameters": {
											"DataSourceID": {
												"value": {
													"value": "@{item().DataSourceId}",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ERROR_FLG",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start logging",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Copy",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started copying data to delta tables",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@item().DatabaseTableName",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_END",
									"description": "End logging",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_UPDATE_LAST_EXECUTION_DATE",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished copying data and executing Databricks notebook to transform @{item().DataSourceName}/@{item().DatabaseTableName}.parquet to Delta Table",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@item().DatabaseTableName",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": {
													"value": "@{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').output.rowsCopied}",
													"type": "Expression"
												},
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_2",
									"description": "notify admins the SQL to raw copy failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "COPY FAILURE - @{pipeline().Pipeline}",
												"type": "Expression"
											},
											"Message": {
												"value": "Error Code: @{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').error.errorCode} - Message: @{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').error.message}",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "@{item().DatabaseSchemaName}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().DatabaseTableName}",
												"type": "Expression"
											},
											"RowsCopied": 0
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "notify admins the SQL to raw copy failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NOTE_JSON_2_PARQUET",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "NOTEBOOK FAILURE - @{pipeline().Pipeline}",
												"type": "Expression"
											},
											"Message": {
												"value": "Notebook - ReadJSONWriteParquet_CosmosDB - DATA FILE PATH - //@{item().DataSourceName}/@{item().DatabaseTableName}-@{variables('UTC_TIME')}.parquet Error Code:  @{activity('ACT_ADB_NOTE_JSON_2_PARQUET').error.errorCode} - Message:  @{activity('ACT_ADB_NOTE_JSON_2_PARQUET').error.message}\n\n\n",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "@{item().DatabaseSchemaName}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().DatabaseTableName}",
												"type": "Expression"
											},
											"RowsCopied": {
												"value": "@{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').output.rowsCopied}",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_ADB_NOTE_JSON_2_PARQUET",
									"type": "DatabricksNotebook",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"notebookPath": "/data_engineering/Source2Raw/ReadJSONWriteParquet_Cosmos",
										"baseParameters": {
											"json_file_path": {
												"value": "/mnt/datalake/raw/@{item().DatabaseName}/@{item().DataSourceName}-@{item().DatabaseTableName}-@{variables('UTC_TIME')}.json",
												"type": "Expression"
											},
											"parquet_output_path": {
												"value": "/mnt/datalake/raw/@{item().DatabaseName}/@{item().DatabaseTableName}-@{variables('UTC_TIME')}/@{item().DataSourceName}",
												"type": "Expression"
											},
											"database_container_name": {
												"value": "@item().DatabaseTableName",
												"type": "Expression"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ADB_SPARK_CLUSTER",
										"type": "LinkedServiceReference"
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "notify admins the asql sql auth to raw lookup failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "FAILURE: @{pipeline().Pipeline} Lookup Failure",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('Error Code:', activity('ACT_GEN_LKP_TABLES').error.errorCode, ' - Message:', activity('ACT_GEN_LKP_TABLES').error.message)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "ERROR_FLG",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_UTC_STAMP",
						"description": "set the UTC timestamp which will be later used as part of the downloaded filenames",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "UTC_TIME",
							"value": {
								"value": "@{utcnow('yyyyMMddTHH:mm:ss')}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of source_2_raw pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_DIST_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "End of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished copying data to delta tables",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "SUCCESS: @{pipeline().Pipeline}",
									"type": "Expression"
								},
								"Message": {
									"value": "SUCCESS: Source to delta tables incremental copy pipeline run has been successfully completed.",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_LOCAL_TIME",
						"description": "set the UTC timestamp which will be later used as part of the downloaded filenames",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "LOCAL_TIME",
							"value": {
								"value": "@convertTimeZone(utcnow(), 'UTC', 'Pacific Standard Time', 'yyyy-MM-dd hh:mm:ss')",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ACT_EXECUTE_ADD_NECESSARY_COLUMNS",
						"description": "This notebook will add the Ori code to the userprofile dataset",
						"type": "DatabricksNotebook",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebookPath": "/data_engineering/Source2Raw/AddNecessaryColumns",
							"baseParameters": {
								"utc_time": {
									"value": "@variables('UTC_TIME')",
									"type": "Expression"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ADB_SPARK_CLUSTER",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_4",
						"description": "notify admins the asql sql auth to raw lookup failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_EXECUTE_ADD_NECESSARY_COLUMNS",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "FAILURE: @{pipeline().Pipeline} Lookup Failure",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('Error Code:', activity('ACT_EXECUTE_ADD_NECESSARY_COLUMNS').error.errorCode, ' - Message:', activity('ACT_EXECUTE_ADD_NECESSARY_COLUMNS').error.message)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_LKUP_DISTINCT_TABLENAME",
						"description": "Grabs the unique table names for combining parquets across multiple agencies.",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_EXECUTE_ADD_NECESSARY_COLUMNS",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "SELECT DISTINCT DatabaseTableName, \nDatabaseName\nFROM [adf].[DataSource]\nWHERE datasourcetype = 'cosmosdb' and isenabled = 1",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_DIST_TABLE",
						"description": "Combine multiple sets of parquets across multiple agencies",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_LKUP_DISTINCT_TABLENAME",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_LKUP_DISTINCT_TABLENAME').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "ACT_COMBINE_PARQUET_FILES",
									"type": "DatabricksNotebook",
									"dependsOn": [],
									"policy": {
										"timeout": "7.00:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"notebookPath": "/data_engineering/Source2Raw/Combine_Parquets_for_MultiList_tables",
										"baseParameters": {
											"database_container_name": {
												"value": "@item().DatabaseTableName",
												"type": "Expression"
											},
											"parquet_output_path": {
												"value": "/mnt/datalake/raw/@{item().DatabaseName}/main",
												"type": "Expression"
											},
											"UTC_TIME": {
												"value": "@variables('UTC_TIME')",
												"type": "Expression"
											},
											"parquet_input_path": {
												"value": "/mnt/datalake/raw/@{item().DatabaseName}",
												"type": "Expression"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ADB_SPARK_CLUSTER",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_5",
									"description": "notify admins the asql sql auth to raw lookup failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_COMBINE_PARQUET_FILES",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "FAILURE: @{pipeline().Pipeline} Lookup Failure",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('Error Code:', activity('ACT_COMBINE_PARQUET_FILES').error.errorCode, ' - Message:', activity('ACT_COMBINE_PARQUET_FILES').error.message)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red"
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": false
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					},
					"DataSourceName": {
						"type": "string",
						"defaultValue": "-"
					},
					"DataSourceType": {
						"type": "string",
						"defaultValue": "cosmosdb"
					},
					"DataSourceID": {
						"type": "string",
						"defaultValue": "NULL"
					}
				},
				"variables": {
					"ERROR_FLG": {
						"type": "Boolean"
					},
					"SCHEMA_NAME": {
						"type": "String"
					},
					"TABLE_NAME": {
						"type": "String"
					},
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"UTC_TIME": {
						"type": "String"
					},
					"USER_NAME": {
						"type": "String"
					},
					"SECRET_NAME": {
						"type": "String"
					},
					"LOCAL_TIME": {
						"type": "String"
					}
				},
				"folder": {
					"name": "100_SOURCE_2_RAW/FULL"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:47Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]",
				"[concat(variables('factoryId'), '/datasets/DS_COSMOSDB')]",
				"[concat(variables('factoryId'), '/datasets/DS_ADLS_RAW_JSON')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_SOURCE_2_RAW_CSV')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "This pipeline will ingest csv files in the raw container and convert them to delta/parquet format",
				"activities": [
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start of source_2_raw pipeline. Stored procedure that logs it.",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "Start of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started copying data to delta tables",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_LKP_TABLES",
						"description": "lookup tables that are enabled in metadata table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderStoredProcedureName": "[[adf].[uspGetTableListing]",
								"storedProcedureParameters": {
									"DataSourceName": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceName",
											"type": "Expression"
										}
									},
									"DataSourceType": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceType",
											"type": "Expression"
										}
									},
									"Incremental": {
										"type": "String",
										"value": "0"
									},
									"DataSourceID": {
										"type": "String",
										"value": {
											"value": "@pipeline().parameters.DataSourceID",
											"type": "Expression"
										}
									}
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "iterate through each table and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SET_VAR_UTC_STAMP",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_GEN_SET_VAR_LOCAL_TIME",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
									"description": "copy tables to raw parquet",
									"type": "Copy",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.06:00:00",
										"retry": 2,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"source": {
											"type": "DelimitedTextSource",
											"storeSettings": {
												"type": "AzureBlobFSReadSettings",
												"recursive": true,
												"enablePartitionDiscovery": false
											},
											"formatSettings": {
												"type": "DelimitedTextReadSettings"
											}
										},
										"sink": {
											"type": "DelimitedTextSink",
											"storeSettings": {
												"type": "AzureBlobFSWriteSettings"
											},
											"formatSettings": {
												"type": "DelimitedTextWriteSettings",
												"quoteAllText": true,
												"fileExtension": ".txt"
											}
										},
										"enableStaging": false,
										"parallelCopies": 5
									},
									"inputs": [
										{
											"referenceName": "DS_ADLS_DROPZONE",
											"type": "DatasetReference",
											"parameters": {
												"DS_FILENAME": {
													"value": "@item().DataLakeEntityName",
													"type": "Expression"
												},
												"DS_FILEPATH": {
													"value": "@item().DataLakePath",
													"type": "Expression"
												},
												"DS_DLCONTAINER": {
													"value": "@item().DatalakeContainerName",
													"type": "Expression"
												}
											}
										}
									],
									"outputs": [
										{
											"referenceName": "DS_ADLS_CSV",
											"type": "DatasetReference",
											"parameters": {
												"DataSourceName": {
													"value": "@item().DatasourceName",
													"type": "Expression"
												},
												"FileName": {
													"value": "@{item().DatabaseTableName}-@{variables('UTC_TIME')}.csv",
													"type": "Expression"
												}
											}
										}
									]
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_2",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_2",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ERROR_FLG",
										"value": true
									}
								},
								{
									"name": "ACT_ADB_NOTE_PARQUET_2_DELTA",
									"description": "runs notebook to convert parquet to delta  table",
									"type": "DatabricksNotebook",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.01:00:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"notebookPath": {
											"value": "@pipeline().parameters.NotebookPath",
											"type": "Expression"
										},
										"baseParameters": {
											"datafile_path": {
												"value": "/@{item().DataSourceName}/@{item().DatabaseTableName}-@{variables('UTC_TIME')}.csv",
												"type": "Expression"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ADB_SPARK_CLUSTER",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "ACT_GEN_SPRC_UPDATE_LAST_EXECUTION_DATE",
									"description": "log full load finish datetime for the source table ",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NOTE_PARQUET_2_DELTA",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 0,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspUpdateLastExecutionDate]",
										"storedProcedureParameters": {
											"DataSourceID": {
												"value": {
													"value": "@{item().DataSourceId}",
													"type": "Expression"
												},
												"type": "String"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "ERROR_FLG",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start logging",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Copy",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started copying data to delta tables",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@item().DatabaseTableName",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_END",
									"description": "End logging",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_UPDATE_LAST_EXECUTION_DATE",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished copying data and executing Databricks notebook to transform @{item().DataSourceName}/@{item().DatabaseTableName}.parquet to Delta Table",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@item().DatabaseTableName",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "@item().DataSourceName",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": {
													"value": "0",
													"type": "Expression"
												},
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_2",
									"description": "notify admins the SQL to raw copy failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "COPY FAILURE - @{pipeline().Pipeline}",
												"type": "Expression"
											},
											"Message": {
												"value": "Error Code: @{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').error.errorCode} - Message: @{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').error.message}",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "@{item().DatabaseSchemaName}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().DatabaseTableName}",
												"type": "Expression"
											},
											"RowsCopied": 0
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "notify admins the SQL to raw copy failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NOTE_PARQUET_2_DELTA",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "NOTEBOOK FAILURE - @{pipeline().Pipeline}",
												"type": "Expression"
											},
											"Message": {
												"value": "Notebook - @{pipeline().parameters.NotebookPath}  DATA FILE PATH - //@{item().DataSourceName}/@{item().DatabaseTableName}-@{variables('UTC_TIME')}.parquet Error Code:  @{activity('ACT_ADB_NOTE_PARQUET_2_DELTA').error.errorCode} - Message:  @{activity('ACT_ADB_NOTE_PARQUET_2_DELTA').error.message}\n\n\n",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "@{item().DatabaseSchemaName}",
												"type": "Expression"
											},
											"TableName": {
												"value": "@{item().DatabaseTableName}",
												"type": "Expression"
											},
											"RowsCopied": {
												"value": "@{activity('ACT_MT_COPY_SQL_WIN_AUTH_2_ADLS').output.rowsCopied}",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "notify admins the asql sql auth to raw lookup failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "FAILURE: @{pipeline().Pipeline} Lookup Failure",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('Error Code:', activity('ACT_GEN_LKP_TABLES').error.errorCode, ' - Message:', activity('ACT_GEN_LKP_TABLES').error.message)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "ERROR_FLG",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_UTC_STAMP",
						"description": "set the UTC timestamp which will be later used as part of the downloaded filenames",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "UTC_TIME",
							"value": {
								"value": "@{utcnow('yyyyMMddTHH:mm:ss')}",
								"type": "Expression"
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of source_2_raw pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": {
										"value": "End of @{pipeline().Pipeline}",
										"type": "Expression"
									},
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished copying data to delta tables",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "SUCCESS: @{pipeline().Pipeline}",
									"type": "Expression"
								},
								"Message": {
									"value": "SUCCESS: Source to delta tables incremental copy pipeline run has been successfully completed.",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_LOCAL_TIME",
						"description": "set the UTC timestamp which will be later used as part of the downloaded filenames",
						"type": "SetVariable",
						"dependsOn": [],
						"userProperties": [],
						"typeProperties": {
							"variableName": "LOCAL_TIME",
							"value": {
								"value": "@convertTimeZone(utcnow(), 'UTC', 'Pacific Standard Time', 'yyyy-MM-dd hh:mm:ss')",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": false
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "Troy.Peckman@sdsheriff.gov"
					},
					"NotebookPath": {
						"type": "string",
						"defaultValue": "/data_engineering/Source2Raw/Source2RawFullLoad"
					},
					"DataSourceName": {
						"type": "string",
						"defaultValue": "static"
					},
					"DataSourceType": {
						"type": "string",
						"defaultValue": "csv"
					},
					"DataSourceID": {
						"type": "string",
						"defaultValue": "NULL"
					}
				},
				"variables": {
					"ERROR_FLG": {
						"type": "Boolean"
					},
					"SCHEMA_NAME": {
						"type": "String"
					},
					"TABLE_NAME": {
						"type": "String"
					},
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"UTC_TIME": {
						"type": "String"
					},
					"USER_NAME": {
						"type": "String"
					},
					"SECRET_NAME": {
						"type": "String"
					},
					"LOCAL_TIME": {
						"type": "String"
					}
				},
				"folder": {
					"name": "100_SOURCE_2_RAW/FULL"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:48Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/datasets/DS_ADLS_DROPZONE')]",
				"[concat(variables('factoryId'), '/datasets/DS_ADLS_CSV')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_STAGE_2_MDW_CHILD')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "run the correct dbr notebooks to promote raw data to staget data",
				"activities": [
					{
						"name": "ACT_GEN_LKP_TABLES",
						"description": "Lookup the raw2stage notebooks using the auditing metadata table",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 5,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": {
									"value": "@concat('select destinationname as notebookname, targetTable, max(level)  as level\nfrom [adf].[vwProcessingDependency]\ngroup by destinationname, targetTable\nhaving max(level) =  ',pipeline().parameters.Level_ID)",
									"type": "Expression"
								},
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": {
										"value": "@variables('ETL_ASQL_CONN_SEC')",
										"type": "Expression"
									},
									"DS_DB_SCHEMA_NAME": {
										"value": "adf",
										"type": "Expression"
									},
									"DS_DB_TABLE_NAME": "DataSource"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": false,
							"batchCount": 8,
							"activities": [
								{
									"name": "ACT_ADB_NB_RAW2STAGE",
									"description": "Run RAW2STAGE notebook",
									"type": "DatabricksNotebook",
									"dependsOn": [
										{
											"activity": "ACT_WAIT",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "1.10:00:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"notebookPath": {
											"value": "@{pipeline().parameters.NotebookPath}/@{item().notebookname}\n",
											"type": "Expression"
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ADB_SPARK_CLUSTER",
										"type": "LinkedServiceReference"
									}
								},
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "IS_ERROR",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "Notify admins raw2stage nb failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NB_RAW2STAGE",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('FAILURE: Notebook Failure -  ', pipeline().Pipeline, ' ',item().datasourcename, '.', item().databasetablename)",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('Notebook - ', pipeline().parameters.NotebookPath,   item().datasourcename, '/', item().databasetablename, ' Error Code:', activity('ACT_ADB_NB_RAW2STAGE').error.errorCode, ' - Message:', activity('ACT_ADB_NB_RAW2STAGE').error.message)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "'NA'",
												"type": "Expression"
											},
											"TableName": {
												"value": "'NA'",
												"type": "Expression"
											},
											"RowsCopied": 0
										}
									}
								},
								{
									"name": "ACT_WAIT",
									"description": "randomly wait so that we don't overwhelm the databricks scheduling queue",
									"type": "Wait",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ADB_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"waitTimeInSeconds": {
											"value": "@rand(1,10)",
											"type": "Expression"
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ADB_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started transforming table from stage to MDW",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().targetTable}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ADB_ITEM_END",
									"description": "",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_ADB_NB_RAW2STAGE",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Notebook",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished executing ADB Notebook to transform @{item().notebookName} to MDW",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "@{item().targetTable}",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					},
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "Notify admins that the lookup of the raw2stage notebooks failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('FAILURE - ' , pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('error code:',\nactivity('ACT_GEN_LKP_TABLES').output.error.errorCode\n, ' - Message: ',\nactivity('ACT_GEN_LKP_TABLES').output.error.message\n)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_EPIPE_SUCCESS_NOTIFY_1",
						"description": "email success notification",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_END",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": false,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('SUCCESS - ', pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "Stage2MDW Completed\n",
									"type": "Expression"
								},
								"Importance": "Low",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Green"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "IS_ERROR",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "Start of Raw_2_Stage",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "End of Raw_2_Stage",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": true
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "brian.rotich@insight.com"
					},
					"NotebookPath": {
						"type": "string",
						"defaultValue": "/data_engineering"
					},
					"Level_ID": {
						"type": "string",
						"defaultValue": "0"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"IS_ERROR": {
						"type": "Boolean"
					}
				},
				"folder": {
					"name": "300_STAGE_2_MDW"
				},
				"annotations": [],
				"lastPublishTime": "2021-09-14T14:26:05Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_STAGE_2_MDW_PARENT')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "run the correct dbr notebooks to promote raw data to staget data",
				"activities": [
					{
						"name": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
						"description": "Notify admins that the lookup of the raw2stage notebooks failed",
						"type": "ExecutePipeline",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Failed"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"pipeline": {
								"referenceName": "PL_LOGMSG_AND_SENDEMAIL",
								"type": "PipelineReference"
							},
							"waitOnCompletion": true,
							"parameters": {
								"IsError": true,
								"EmailTo": {
									"value": "@pipeline().parameters.SendEmailNotificationAddress",
									"type": "Expression"
								},
								"Subject": {
									"value": "@concat('FAILURE - ' , pipeline().Pipeline)",
									"type": "Expression"
								},
								"Message": {
									"value": "@concat('error code:',\nactivity('ACT_GEN_LKP_TABLES').output.error.errorCode\n, ' - Message: ',\nactivity('ACT_GEN_LKP_TABLES').output.error.message\n)",
									"type": "Expression"
								},
								"Importance": "High",
								"EmailEnabled": {
									"value": "@pipeline().parameters.EnableNotifications",
									"type": "Expression"
								},
								"PipelineName": {
									"value": "@pipeline().Pipeline",
									"type": "Expression"
								},
								"PipelineRunID": {
									"value": "@pipeline().RunId",
									"type": "Expression"
								},
								"DataFactoryName": {
									"value": "@pipeline().DataFactory",
									"type": "Expression"
								},
								"Etl_DB_Conn_Secret": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								},
								"Color": "Red"
							}
						}
					},
					{
						"name": "ACT_GEN_SET_VAR_ERR_FLG_1",
						"description": "set error_flag variable to true",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_1",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "IS_ERROR",
							"value": true
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_START",
						"description": "start raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "Start of Raw_2_Stage",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Started transforming tables from raw to stage",
									"type": "String"
								},
								"IsEnd": {
									"value": "false",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "true",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_SPRC_LOG_PL_END",
						"description": "end of raw_2_stage pipeline",
						"type": "SqlServerStoredProcedure",
						"dependsOn": [
							{
								"activity": "ACT_ITRC_FOR_EACH_TABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "0.00:05:00",
							"retry": 3,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
							"storedProcedureParameters": {
								"CallingProcess": {
									"value": "End of Stage_2_MDW",
									"type": "String"
								},
								"DataFactoryName": {
									"value": {
										"value": "@pipeline().DataFactory",
										"type": "Expression"
									},
									"type": "String"
								},
								"ExecutionMessage": {
									"value": "Finished transforming tables from stage to MDW",
									"type": "String"
								},
								"IsEnd": {
									"value": "true",
									"type": "Boolean"
								},
								"IsError": {
									"value": "false",
									"type": "Boolean"
								},
								"IsStart": {
									"value": "false",
									"type": "Boolean"
								},
								"PipelineName": {
									"value": {
										"value": "@pipeline().Pipeline",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineRunID": {
									"value": {
										"value": "@pipeline().RunId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerID": {
									"value": {
										"value": "@pipeline().TriggerId",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerName": {
									"value": {
										"value": "@pipeline().TriggerName",
										"type": "Expression"
									},
									"type": "String"
								},
								"PipelineTriggerTime": {
									"value": {
										"value": "@pipeline().TriggerTime",
										"type": "Expression"
									},
									"type": "DateTime"
								},
								"PipelineTriggerType": {
									"value": {
										"value": "@pipeline().TriggerType",
										"type": "Expression"
									},
									"type": "String"
								},
								"TableName": {
									"value": "N/A",
									"type": "String"
								},
								"TableSchema": {
									"value": "N/A",
									"type": "String"
								},
								"IsInnerActivity": {
									"value": "false",
									"type": "Boolean"
								},
								"RowsCopied": {
									"value": "0",
									"type": "Int64"
								}
							}
						},
						"linkedServiceName": {
							"referenceName": "LS_ASQL_SQL_AUTH",
							"type": "LinkedServiceReference",
							"parameters": {
								"LS_ASQL_SQL_AUTH_CONN_SECRET": {
									"value": "@variables('ETL_ASQL_CONN_SEC')",
									"type": "Expression"
								}
							}
						}
					},
					{
						"name": "ACT_GEN_LKP_TABLES",
						"type": "Lookup",
						"dependsOn": [
							{
								"activity": "ACT_GEN_SPRC_LOG_PL_START",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select level\nfrom [adf].[vwProcessingDependency]\ngroup by level\norder by level asc",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": "@variables('ETL_ASQL_CONN_SEC')",
									"DS_DB_SCHEMA_NAME": "adf",
									"DS_DB_TABLE_NAME": "vwProcessingDependency"
								}
							},
							"firstRowOnly": false
						}
					},
					{
						"name": "ACT_ITRC_FOR_EACH_TABLE",
						"description": "Iterate through each item and perform the copy ",
						"type": "ForEach",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_TABLES",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"items": {
								"value": "@activity('ACT_GEN_LKP_TABLES').output.value",
								"type": "Expression"
							},
							"isSequential": true,
							"activities": [
								{
									"name": "ACT_GEN_SET_VAR_ERR_FLG_3",
									"description": "set error_flag variable to true",
									"type": "SetVariable",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"variableName": "IS_ERROR",
										"value": true
									}
								},
								{
									"name": "ACT_GEN_EPIPE_ERR_NOTIFY_3",
									"description": "Notify admins raw2stage nb failed",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_STAGE2MDW_CHILD",
											"dependencyConditions": [
												"Failed"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_LOGMSG_AND_SENDEMAIL_ITEM",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"IsError": true,
											"EmailTo": {
												"value": "@pipeline().parameters.SendEmailNotificationAddress",
												"type": "Expression"
											},
											"Subject": {
												"value": "@concat('FAILURE: Notebook Failure -  ', pipeline().Pipeline, ' ',item().datasourcename, '.', item().databasetablename)",
												"type": "Expression"
											},
											"Message": {
												"value": "@concat('Notebook - ', pipeline().parameters.NotebookPath, '/', item().targettable, ' Error Code:', activity('ACT_GEN_EPIPE_STAGE2MDW_CHILD').error.errorCode, ' - Message:', activity('ACT_GEN_EPIPE_STAGE2MDW_CHILD').error.message)",
												"type": "Expression"
											},
											"Importance": "High",
											"EmailEnabled": {
												"value": "@pipeline().parameters.EnableNotifications",
												"type": "Expression"
											},
											"PipelineName": {
												"value": "@pipeline().Pipeline",
												"type": "Expression"
											},
											"PipelineRunID": {
												"value": "@pipeline().RunId",
												"type": "Expression"
											},
											"DataFactoryName": {
												"value": "@pipeline().DataFactory",
												"type": "Expression"
											},
											"Etl_DB_Conn_Secret": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											},
											"Color": "Red",
											"TableSchema": {
												"value": "'NA'",
												"type": "Expression"
											},
											"TableName": {
												"value": "'NA'",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ITEM_START",
									"description": "start ASQL SQL Auth to delta tables full load",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Pipeline",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": "Started executing child pipeline per level id",
												"type": "String"
											},
											"IsEnd": {
												"value": "false",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "true",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": {
													"value": "N/A",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableSchema": {
												"value": {
													"value": "N/A",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_SPRC_LOG_ADB_ITEM_END",
									"description": "",
									"type": "SqlServerStoredProcedure",
									"dependsOn": [
										{
											"activity": "ACT_GEN_EPIPE_STAGE2MDW_CHILD",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"policy": {
										"timeout": "0.00:05:00",
										"retry": 3,
										"retryIntervalInSeconds": 30,
										"secureOutput": false,
										"secureInput": false
									},
									"userProperties": [],
									"typeProperties": {
										"storedProcedureName": "[[adf].[uspLogExecutionMessage]",
										"storedProcedureParameters": {
											"CallingProcess": {
												"value": "Pipeline",
												"type": "String"
											},
											"DataFactoryName": {
												"value": {
													"value": "@pipeline().DataFactory",
													"type": "Expression"
												},
												"type": "String"
											},
											"ExecutionMessage": {
												"value": {
													"value": "Finished executing pipeline for level id for level @{item().level} to MDW",
													"type": "Expression"
												},
												"type": "String"
											},
											"IsEnd": {
												"value": "true",
												"type": "Boolean"
											},
											"IsError": {
												"value": "false",
												"type": "Boolean"
											},
											"IsStart": {
												"value": "false",
												"type": "Boolean"
											},
											"PipelineName": {
												"value": {
													"value": "@pipeline().Pipeline",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineRunID": {
												"value": {
													"value": "@pipeline().RunId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerID": {
												"value": {
													"value": "@pipeline().TriggerId",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerName": {
												"value": {
													"value": "@pipeline().TriggerName",
													"type": "Expression"
												},
												"type": "String"
											},
											"PipelineTriggerTime": {
												"value": {
													"value": "@pipeline().TriggerTime",
													"type": "Expression"
												},
												"type": "DateTime"
											},
											"PipelineTriggerType": {
												"value": {
													"value": "@pipeline().TriggerType",
													"type": "Expression"
												},
												"type": "String"
											},
											"TableName": {
												"value": "N/A",
												"type": "String"
											},
											"TableSchema": {
												"value": "N/A",
												"type": "String"
											},
											"IsInnerActivity": {
												"value": "true",
												"type": "Boolean"
											},
											"RowsCopied": {
												"value": "0",
												"type": "Int64"
											}
										}
									},
									"linkedServiceName": {
										"referenceName": "LS_ASQL_SQL_AUTH",
										"type": "LinkedServiceReference",
										"parameters": {
											"LS_ASQL_SQL_AUTH_CONN_SECRET": {
												"value": "@variables('ETL_ASQL_CONN_SEC')",
												"type": "Expression"
											}
										}
									}
								},
								{
									"name": "ACT_GEN_EPIPE_STAGE2MDW_CHILD",
									"type": "ExecutePipeline",
									"dependsOn": [
										{
											"activity": "ACT_GEN_SPRC_LOG_ITEM_START",
											"dependencyConditions": [
												"Succeeded"
											]
										}
									],
									"userProperties": [],
									"typeProperties": {
										"pipeline": {
											"referenceName": "PL_STAGE_2_MDW_CHILD",
											"type": "PipelineReference"
										},
										"waitOnCompletion": true,
										"parameters": {
											"EnableNotifications": true,
											"SendEmailNotificationAddress": "brian.rotich@insight.com",
											"NotebookPath": "/data_engineering",
											"Level_ID": {
												"value": "@{item().level}",
												"type": "Expression"
											}
										}
									}
								}
							]
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"parameters": {
					"EnableNotifications": {
						"type": "bool",
						"defaultValue": true
					},
					"SendEmailNotificationAddress": {
						"type": "string",
						"defaultValue": "brian.rotich@insight.com"
					},
					"NotebookPath": {
						"type": "string",
						"defaultValue": "/data_engineering"
					}
				},
				"variables": {
					"ETL_ASQL_CONN_SEC": {
						"type": "String",
						"defaultValue": "sec-mdw-db-connection-string"
					},
					"IS_ERROR": {
						"type": "Boolean"
					}
				},
				"folder": {
					"name": "300_STAGE_2_MDW"
				},
				"annotations": [],
				"lastPublishTime": "2021-09-14T14:26:05Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL')]",
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]",
				"[concat(variables('factoryId'), '/pipelines/PL_LOGMSG_AND_SENDEMAIL_ITEM')]",
				"[concat(variables('factoryId'), '/pipelines/PL_STAGE_2_MDW_CHILD')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/PL_UPDATE_AAS_SECURITY_READERS')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "ACT_EXECUTE_CREATE_XMLA_FILE",
						"description": "This activity will execute a Databricks notebook that will create a XMLA file for the Security-Readers role in the AAS ripamodel",
						"type": "DatabricksNotebook",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebookPath": "/data_engineering/AAS/create_xmla_file"
						},
						"linkedServiceName": {
							"referenceName": "LS_ADB_SPARK_CLUSTER",
							"type": "LinkedServiceReference"
						}
					},
					{
						"name": "ACT_CALL_RUN_AAS_SEC_READERS_WEBHOOK",
						"description": "This webhook call will run the Run_AAS_Sec_Readers (sdsd-ripa-etl-d-aaa/Run_AAS_Sec_Readers) runbook (powershell script) which will execute the created XMLA file.",
						"type": "WebHook",
						"dependsOn": [
							{
								"activity": "ACT_EXECUTE_CREATE_XMLA_FILE",
								"dependencyConditions": [
									"Succeeded"
								]
							},
							{
								"activity": "ACT_SET_WEBHOOK_VARIABLE",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"url": {
								"value": "@variables('AAS_SEC_READERS_WEBHOOK')",
								"type": "Expression"
							},
							"method": "POST",
							"headers": {},
							"body": {
								"message": "Execute Run_AAS_Sec_Readers"
							},
							"timeout": "00:10:00",
							"reportStatusOnCallBack": true
						}
					},
					{
						"name": "ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK",
						"description": "Lookup Webhook from adf.LogicAppURL table.",
						"type": "Lookup",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "AzureSqlSource",
								"sqlReaderQuery": "select * from adf.LogicAppURL where logicAppType = 'AAS_Sec_Readers'",
								"queryTimeout": "02:00:00",
								"partitionOption": "None"
							},
							"dataset": {
								"referenceName": "DS_ASQL_SQL_AUTH",
								"type": "DatasetReference",
								"parameters": {
									"DS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string",
									"DS_DB_SCHEMA_NAME": "adf",
									"DS_DB_TABLE_NAME": "LogicAppURL"
								}
							},
							"firstRowOnly": true
						}
					},
					{
						"name": "ACT_SET_WEBHOOK_VARIABLE",
						"description": "Assign webhook url to variable",
						"type": "SetVariable",
						"dependsOn": [
							{
								"activity": "ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK",
								"dependencyConditions": [
									"Succeeded"
								]
							}
						],
						"userProperties": [],
						"typeProperties": {
							"variableName": "AAS_SEC_READERS_WEBHOOK",
							"value": {
								"value": "@activity('ACT_GEN_LKP_RUN_AAS_SEC_READERS_WEBHOOK').output.firstRow.LogicAppUrl",
								"type": "Expression"
							}
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"variables": {
					"AAS_SEC_READERS_WEBHOOK": {
						"type": "String"
					}
				},
				"folder": {
					"name": "500_PROCESS_AAS"
				},
				"annotations": [],
				"lastPublishTime": "2022-06-27T17:03:55Z"
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADB_SPARK_CLUSTER')]",
				"[concat(variables('factoryId'), '/datasets/DS_ASQL_SQL_AUTH')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_CSV')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DataSourceName": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().DataSourceName",
							"type": "Expression"
						},
						"fileSystem": "raw"
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_DROPZONE')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DS_FILENAME": {
						"type": "string"
					},
					"DS_FILEPATH": {
						"type": "string"
					},
					"DS_DLCONTAINER": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "DelimitedText",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().DS_FILENAME",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().DS_FILEPATH",
							"type": "Expression"
						},
						"fileSystem": {
							"value": "@dataset().DS_DLCONTAINER",
							"type": "Expression"
						}
					},
					"columnDelimiter": ",",
					"escapeChar": "\\",
					"firstRowAsHeader": true,
					"quoteChar": "\""
				},
				"schema": [
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					},
					{
						"type": "String"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_MDW')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"SchemaName": {
						"type": "string",
						"defaultValue": "ContainerOps"
					},
					"FileName": {
						"type": "string",
						"defaultValue": "DimCompany"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().SchemaName",
							"type": "Expression"
						},
						"fileSystem": "mdw"
					},
					"compressionCodec": "snappy"
				},
				"schema": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_RAW')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DataSourceName": {
						"type": "String"
					},
					"FileName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().DataSourceName",
							"type": "Expression"
						},
						"fileSystem": "raw"
					},
					"compressionCodec": "snappy"
				},
				"schema": [
					{
						"name": "Id",
						"type": "UTF8"
					},
					{
						"name": "SinkCreatedOn",
						"type": "INT96"
					},
					{
						"name": "SinkModifiedOn",
						"type": "INT96"
					},
					{
						"name": "statecode",
						"type": "INT32"
					},
					{
						"name": "statuscode",
						"type": "INT32"
					},
					{
						"name": "address1_addresstypecode",
						"type": "INT32"
					},
					{
						"name": "msdyn_travelchargetype",
						"type": "INT32"
					},
					{
						"name": "address1_shippingmethodcode",
						"type": "INT32"
					},
					{
						"name": "address1_freighttermscode",
						"type": "INT32"
					},
					{
						"name": "accountratingcode",
						"type": "INT32"
					},
					{
						"name": "preferredappointmenttimecode",
						"type": "INT32"
					},
					{
						"name": "accountclassificationcode",
						"type": "INT32"
					},
					{
						"name": "customertypecode",
						"type": "INT32"
					},
					{
						"name": "preferredcontactmethodcode",
						"type": "INT32"
					},
					{
						"name": "ownershipcode",
						"type": "INT32"
					},
					{
						"name": "address2_addresstypecode",
						"type": "INT32"
					},
					{
						"name": "businesstypecode",
						"type": "INT32"
					},
					{
						"name": "shippingmethodcode",
						"type": "INT32"
					},
					{
						"name": "paymenttermscode",
						"type": "INT32"
					},
					{
						"name": "customersizecode",
						"type": "INT32"
					},
					{
						"name": "accountcategorycode",
						"type": "INT32"
					},
					{
						"name": "industrycode",
						"type": "INT32"
					},
					{
						"name": "preferredappointmentdaycode",
						"type": "INT32"
					},
					{
						"name": "address2_shippingmethodcode",
						"type": "INT32"
					},
					{
						"name": "address2_freighttermscode",
						"type": "INT32"
					},
					{
						"name": "territorycode",
						"type": "INT32"
					},
					{
						"name": "donotpostalmail",
						"type": "BOOLEAN"
					},
					{
						"name": "creditonhold",
						"type": "BOOLEAN"
					},
					{
						"name": "donotbulkpostalmail",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_enableforlearnerexperienceportal",
						"type": "BOOLEAN"
					},
					{
						"name": "donotbulkemail",
						"type": "BOOLEAN"
					},
					{
						"name": "donotfax",
						"type": "BOOLEAN"
					},
					{
						"name": "msdyn_gdproptout",
						"type": "BOOLEAN"
					},
					{
						"name": "donotemail",
						"type": "BOOLEAN"
					},
					{
						"name": "marketingonly",
						"type": "BOOLEAN"
					},
					{
						"name": "followemail",
						"type": "BOOLEAN"
					},
					{
						"name": "merged",
						"type": "BOOLEAN"
					},
					{
						"name": "donotphone",
						"type": "BOOLEAN"
					},
					{
						"name": "donotsendmm",
						"type": "BOOLEAN"
					},
					{
						"name": "participatesinworkflow",
						"type": "BOOLEAN"
					},
					{
						"name": "isprivate",
						"type": "BOOLEAN"
					},
					{
						"name": "msdyn_taxexempt",
						"type": "BOOLEAN"
					},
					{
						"name": "slainvokedid",
						"type": "UTF8"
					},
					{
						"name": "slainvokedid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "originatingleadid",
						"type": "UTF8"
					},
					{
						"name": "originatingleadid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "owningbusinessunit",
						"type": "UTF8"
					},
					{
						"name": "owningbusinessunit_entitytype",
						"type": "UTF8"
					},
					{
						"name": "territoryid",
						"type": "UTF8"
					},
					{
						"name": "territoryid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "slaid",
						"type": "UTF8"
					},
					{
						"name": "slaid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "primarycontactid",
						"type": "UTF8"
					},
					{
						"name": "primarycontactid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "parentaccountid",
						"type": "UTF8"
					},
					{
						"name": "parentaccountid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "createdonbehalfby",
						"type": "UTF8"
					},
					{
						"name": "createdonbehalfby_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_preferredresource",
						"type": "UTF8"
					},
					{
						"name": "msdyn_preferredresource_entitytype",
						"type": "UTF8"
					},
					{
						"name": "modifiedby",
						"type": "UTF8"
					},
					{
						"name": "modifiedby_entitytype",
						"type": "UTF8"
					},
					{
						"name": "modifiedonbehalfby",
						"type": "UTF8"
					},
					{
						"name": "modifiedonbehalfby_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_workhourtemplate",
						"type": "UTF8"
					},
					{
						"name": "msdyn_workhourtemplate_entitytype",
						"type": "UTF8"
					},
					{
						"name": "owninguser",
						"type": "UTF8"
					},
					{
						"name": "owninguser_entitytype",
						"type": "UTF8"
					},
					{
						"name": "owningteam",
						"type": "UTF8"
					},
					{
						"name": "owningteam_entitytype",
						"type": "UTF8"
					},
					{
						"name": "transactioncurrencyid",
						"type": "UTF8"
					},
					{
						"name": "transactioncurrencyid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_tpm",
						"type": "UTF8"
					},
					{
						"name": "esi_tpm_entitytype",
						"type": "UTF8"
					},
					{
						"name": "masterid",
						"type": "UTF8"
					},
					{
						"name": "masterid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "modifiedbyexternalparty",
						"type": "UTF8"
					},
					{
						"name": "modifiedbyexternalparty_entitytype",
						"type": "UTF8"
					},
					{
						"name": "defaultpricelevelid",
						"type": "UTF8"
					},
					{
						"name": "defaultpricelevelid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "preferredequipmentid",
						"type": "UTF8"
					},
					{
						"name": "preferredequipmentid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_accountkpiid",
						"type": "UTF8"
					},
					{
						"name": "msdyn_accountkpiid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "createdby",
						"type": "UTF8"
					},
					{
						"name": "createdby_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_billingaccount",
						"type": "UTF8"
					},
					{
						"name": "msdyn_billingaccount_entitytype",
						"type": "UTF8"
					},
					{
						"name": "createdbyexternalparty",
						"type": "UTF8"
					},
					{
						"name": "createdbyexternalparty_entitytype",
						"type": "UTF8"
					},
					{
						"name": "preferredserviceid",
						"type": "UTF8"
					},
					{
						"name": "preferredserviceid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_salestaxcode",
						"type": "UTF8"
					},
					{
						"name": "msdyn_salestaxcode_entitytype",
						"type": "UTF8"
					},
					{
						"name": "preferredsystemuserid",
						"type": "UTF8"
					},
					{
						"name": "preferredsystemuserid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_preferredlearningpartnerid",
						"type": "UTF8"
					},
					{
						"name": "esi_preferredlearningpartnerid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "msdyn_serviceterritory",
						"type": "UTF8"
					},
					{
						"name": "msdyn_serviceterritory_entitytype",
						"type": "UTF8"
					},
					{
						"name": "ownerid",
						"type": "UTF8"
					},
					{
						"name": "ownerid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "aging30",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "aging60_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "marketcap",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "msdyn_travelcharge_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "creditlimit",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "creditlimit_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "aging90_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "aging60",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "aging30_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "revenue",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "msdyn_travelcharge",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "openrevenue",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "revenue_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "openrevenue_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "marketcap_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "aging90",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "emailaddress3",
						"type": "UTF8"
					},
					{
						"name": "emailaddress2",
						"type": "UTF8"
					},
					{
						"name": "emailaddress1",
						"type": "UTF8"
					},
					{
						"name": "masteraccountidyominame",
						"type": "UTF8"
					},
					{
						"name": "address1_city",
						"type": "UTF8"
					},
					{
						"name": "address1_line1",
						"type": "UTF8"
					},
					{
						"name": "modifiedon",
						"type": "INT96"
					},
					{
						"name": "address1_longitude",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 5
					},
					{
						"name": "websiteurl",
						"type": "UTF8"
					},
					{
						"name": "createdbyexternalpartyname",
						"type": "UTF8"
					},
					{
						"name": "entityimage_timestamp",
						"type": "INT64"
					},
					{
						"name": "modifiedbyyominame",
						"type": "UTF8"
					},
					{
						"name": "sharesoutstanding",
						"type": "INT32"
					},
					{
						"name": "primarycontactidname",
						"type": "UTF8"
					},
					{
						"name": "address2_city",
						"type": "UTF8"
					},
					{
						"name": "preferredsystemuseridyominame",
						"type": "UTF8"
					},
					{
						"name": "opendeals_date",
						"type": "INT96"
					},
					{
						"name": "modifiedbyexternalpartyyominame",
						"type": "UTF8"
					},
					{
						"name": "masteraccountidname",
						"type": "UTF8"
					},
					{
						"name": "preferredsystemuseridname",
						"type": "UTF8"
					},
					{
						"name": "preferredserviceidname",
						"type": "UTF8"
					},
					{
						"name": "address2_stateorprovince",
						"type": "UTF8"
					},
					{
						"name": "timespentbymeonemailandmeetings",
						"type": "UTF8"
					},
					{
						"name": "address2_country",
						"type": "UTF8"
					},
					{
						"name": "msdyn_accountkpiidname",
						"type": "UTF8"
					},
					{
						"name": "address2_line2",
						"type": "UTF8"
					},
					{
						"name": "accountid",
						"type": "UTF8"
					},
					{
						"name": "msdyn_preferredresourcename",
						"type": "UTF8"
					},
					{
						"name": "onholdtime",
						"type": "INT32"
					},
					{
						"name": "esi_tpmyominame",
						"type": "UTF8"
					},
					{
						"name": "originatingleadidname",
						"type": "UTF8"
					},
					{
						"name": "parentaccountidname",
						"type": "UTF8"
					},
					{
						"name": "address1_utcoffset",
						"type": "INT32"
					},
					{
						"name": "numberofemployees",
						"type": "INT32"
					},
					{
						"name": "modifiedbyexternalpartyname",
						"type": "UTF8"
					},
					{
						"name": "esi_tpmname",
						"type": "UTF8"
					},
					{
						"name": "exchangerate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 10
					},
					{
						"name": "address2_county",
						"type": "UTF8"
					},
					{
						"name": "esi_tpid",
						"type": "UTF8"
					},
					{
						"name": "address2_line1",
						"type": "UTF8"
					},
					{
						"name": "telephone3",
						"type": "UTF8"
					},
					{
						"name": "msdyn_taxexemptnumber",
						"type": "UTF8"
					},
					{
						"name": "address2_latitude",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 5
					},
					{
						"name": "createdon",
						"type": "INT96"
					},
					{
						"name": "slaname",
						"type": "UTF8"
					},
					{
						"name": "slainvokedidname",
						"type": "UTF8"
					},
					{
						"name": "address1_composite",
						"type": "UTF8"
					},
					{
						"name": "opendeals_state",
						"type": "INT32"
					},
					{
						"name": "address2_postalcode",
						"type": "UTF8"
					},
					{
						"name": "lastusedincampaign",
						"type": "INT96"
					},
					{
						"name": "utcconversiontimezonecode",
						"type": "INT32"
					},
					{
						"name": "msdyn_salestaxcodename",
						"type": "UTF8"
					},
					{
						"name": "owneridyominame",
						"type": "UTF8"
					},
					{
						"name": "entityimage_url",
						"type": "UTF8"
					},
					{
						"name": "teamsfollowed",
						"type": "INT32"
					},
					{
						"name": "address2_line3",
						"type": "UTF8"
					},
					{
						"name": "description",
						"type": "UTF8"
					},
					{
						"name": "timezoneruleversionnumber",
						"type": "INT32"
					},
					{
						"name": "address1_county",
						"type": "UTF8"
					},
					{
						"name": "msdyn_workhourtemplatename",
						"type": "UTF8"
					},
					{
						"name": "esi_preferredlearningpartneridyominame",
						"type": "UTF8"
					},
					{
						"name": "createdbyexternalpartyyominame",
						"type": "UTF8"
					},
					{
						"name": "entityimageid",
						"type": "UTF8"
					},
					{
						"name": "address2_postofficebox",
						"type": "UTF8"
					},
					{
						"name": "address2_telephone1",
						"type": "UTF8"
					},
					{
						"name": "address2_telephone2",
						"type": "UTF8"
					},
					{
						"name": "address2_telephone3",
						"type": "UTF8"
					},
					{
						"name": "originatingleadidyominame",
						"type": "UTF8"
					},
					{
						"name": "preferredequipmentidname",
						"type": "UTF8"
					},
					{
						"name": "address1_addressid",
						"type": "UTF8"
					},
					{
						"name": "traversedpath",
						"type": "UTF8"
					},
					{
						"name": "territoryidname",
						"type": "UTF8"
					},
					{
						"name": "yominame",
						"type": "UTF8"
					},
					{
						"name": "createdonbehalfbyname",
						"type": "UTF8"
					},
					{
						"name": "address2_name",
						"type": "UTF8"
					},
					{
						"name": "openrevenue_state",
						"type": "INT32"
					},
					{
						"name": "primarysatoriid",
						"type": "UTF8"
					},
					{
						"name": "name",
						"type": "UTF8"
					},
					{
						"name": "primarytwitterid",
						"type": "UTF8"
					},
					{
						"name": "owneridname",
						"type": "UTF8"
					},
					{
						"name": "modifiedonbehalfbyname",
						"type": "UTF8"
					},
					{
						"name": "overriddencreatedon",
						"type": "INT96"
					},
					{
						"name": "address2_composite",
						"type": "UTF8"
					},
					{
						"name": "address1_country",
						"type": "UTF8"
					},
					{
						"name": "transactioncurrencyidname",
						"type": "UTF8"
					},
					{
						"name": "address1_stateorprovince",
						"type": "UTF8"
					},
					{
						"name": "address1_line3",
						"type": "UTF8"
					},
					{
						"name": "esi_preferredlearningpartneridname",
						"type": "UTF8"
					},
					{
						"name": "processid",
						"type": "UTF8"
					},
					{
						"name": "msdyn_billingaccountyominame",
						"type": "UTF8"
					},
					{
						"name": "address1_telephone1",
						"type": "UTF8"
					},
					{
						"name": "address1_telephone2",
						"type": "UTF8"
					},
					{
						"name": "address1_telephone3",
						"type": "UTF8"
					},
					{
						"name": "address1_postofficebox",
						"type": "UTF8"
					},
					{
						"name": "createdonbehalfbyyominame",
						"type": "UTF8"
					},
					{
						"name": "address1_name",
						"type": "UTF8"
					},
					{
						"name": "fax",
						"type": "UTF8"
					},
					{
						"name": "sic",
						"type": "UTF8"
					},
					{
						"name": "address2_utcoffset",
						"type": "INT32"
					},
					{
						"name": "stageid",
						"type": "UTF8"
					},
					{
						"name": "accountnumber",
						"type": "UTF8"
					},
					{
						"name": "address2_fax",
						"type": "UTF8"
					},
					{
						"name": "owneridtype",
						"type": "UTF8"
					},
					{
						"name": "address2_longitude",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 5
					},
					{
						"name": "ftpsiteurl",
						"type": "UTF8"
					},
					{
						"name": "createdbyname",
						"type": "UTF8"
					},
					{
						"name": "address1_primarycontactname",
						"type": "UTF8"
					},
					{
						"name": "lastonholdtime",
						"type": "INT96"
					},
					{
						"name": "address1_line2",
						"type": "UTF8"
					},
					{
						"name": "openrevenue_date",
						"type": "INT96"
					},
					{
						"name": "address1_postalcode",
						"type": "UTF8"
					},
					{
						"name": "tickersymbol",
						"type": "UTF8"
					},
					{
						"name": "address2_upszone",
						"type": "UTF8"
					},
					{
						"name": "defaultpricelevelidname",
						"type": "UTF8"
					},
					{
						"name": "msdyn_serviceterritoryname",
						"type": "UTF8"
					},
					{
						"name": "stockexchange",
						"type": "UTF8"
					},
					{
						"name": "msdyn_billingaccountname",
						"type": "UTF8"
					},
					{
						"name": "importsequencenumber",
						"type": "INT32"
					},
					{
						"name": "msdyn_workorderinstructions",
						"type": "UTF8"
					},
					{
						"name": "telephone2",
						"type": "UTF8"
					},
					{
						"name": "versionnumber",
						"type": "INT64"
					},
					{
						"name": "telephone1",
						"type": "UTF8"
					},
					{
						"name": "address2_addressid",
						"type": "UTF8"
					},
					{
						"name": "address1_fax",
						"type": "UTF8"
					},
					{
						"name": "address1_latitude",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 5
					},
					{
						"name": "primarycontactidyominame",
						"type": "UTF8"
					},
					{
						"name": "modifiedbyname",
						"type": "UTF8"
					},
					{
						"name": "createdbyyominame",
						"type": "UTF8"
					},
					{
						"name": "address1_upszone",
						"type": "UTF8"
					},
					{
						"name": "modifiedonbehalfbyyominame",
						"type": "UTF8"
					},
					{
						"name": "parentaccountidyominame",
						"type": "UTF8"
					},
					{
						"name": "address2_primarycontactname",
						"type": "UTF8"
					},
					{
						"name": "opendeals",
						"type": "INT32"
					},
					{
						"name": "esi_prioritizationtranche",
						"type": "INT32"
					},
					{
						"name": "esi_subsegment",
						"type": "UTF8"
					},
					{
						"name": "esi_salesunit",
						"type": "UTF8"
					},
					{
						"name": "esi_area",
						"type": "UTF8"
					},
					{
						"name": "esi_industry",
						"type": "UTF8"
					},
					{
						"name": "esi_segment",
						"type": "UTF8"
					},
					{
						"name": "esi_crmaccountid",
						"type": "UTF8"
					},
					{
						"name": "esi_esicustomertier",
						"type": "INT32"
					},
					{
						"name": "esi_pseid",
						"type": "UTF8"
					},
					{
						"name": "esi_pseid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_totalnumberofitprofessionals",
						"type": "INT32"
					},
					{
						"name": "esi_totalskillingheadcount_state",
						"type": "INT32"
					},
					{
						"name": "esi_totalskillingheadcount",
						"type": "INT32"
					},
					{
						"name": "esi_totalskillingheadcount_date",
						"type": "INT96"
					},
					{
						"name": "esi_msxguid",
						"type": "UTF8"
					},
					{
						"name": "esi_pseidname",
						"type": "UTF8"
					},
					{
						"name": "esi_pseidyominame",
						"type": "UTF8"
					},
					{
						"name": "esi_esicustomertierid",
						"type": "UTF8"
					},
					{
						"name": "esi_esicustomertierid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_esicustomertieridname",
						"type": "UTF8"
					},
					{
						"name": "esi_s500customer",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_region",
						"type": "UTF8"
					},
					{
						"name": "esi_subsidiary",
						"type": "UTF8"
					},
					{
						"name": "esi_territory",
						"type": "UTF8"
					},
					{
						"name": "esi_lxpexceptionreason",
						"type": "UTF8"
					},
					{
						"name": "esi_primarylandingpageurl",
						"type": "UTF8"
					},
					{
						"name": "esi_isvalidprimarylandingpageurl",
						"type": "INT32"
					},
					{
						"name": "esi_industryfocus",
						"type": "UTF8"
					},
					{
						"name": "esi_mpnorgid",
						"type": "UTF8"
					},
					{
						"name": "esi_specialties",
						"type": "UTF8"
					},
					{
						"name": "esi_enterprisecontracts",
						"type": "UTF8"
					},
					{
						"name": "esi_othermsworkloadtraining",
						"type": "UTF8"
					},
					{
						"name": "msa_managingpartnerid",
						"type": "UTF8"
					},
					{
						"name": "msa_managingpartnerid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "adx_modifiedbyusername",
						"type": "UTF8"
					},
					{
						"name": "msa_managingpartneridyominame",
						"type": "UTF8"
					},
					{
						"name": "msa_managingpartneridname",
						"type": "UTF8"
					},
					{
						"name": "adx_modifiedbyipaddress",
						"type": "UTF8"
					},
					{
						"name": "adx_createdbyusername",
						"type": "UTF8"
					},
					{
						"name": "adx_createdbyipaddress",
						"type": "UTF8"
					},
					{
						"name": "esi_numberofmcts",
						"type": "INT32"
					},
					{
						"name": "esi_aad",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_tpc",
						"type": "UTF8"
					},
					{
						"name": "esi_tpc_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_tpcname",
						"type": "UTF8"
					},
					{
						"name": "esi_tpcyominame",
						"type": "UTF8"
					},
					{
						"name": "esi_ispartner",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_iscustomer",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_partneroneid",
						"type": "UTF8"
					},
					{
						"name": "esi_isamp",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_primarytsr",
						"type": "UTF8"
					},
					{
						"name": "esi_primarytsr_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_secondarycontact",
						"type": "UTF8"
					},
					{
						"name": "esi_secondarycontact_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_secondarycontactyominame",
						"type": "UTF8"
					},
					{
						"name": "esi_primarytsrname",
						"type": "UTF8"
					},
					{
						"name": "esi_secondarycontactname",
						"type": "UTF8"
					},
					{
						"name": "msevtmgt_hotelgroup",
						"type": "INT32"
					},
					{
						"name": "msevtmgt_rentalcarprovider",
						"type": "INT32"
					},
					{
						"name": "msdyncrm_insights_placeholder",
						"type": "UTF8"
					},
					{
						"name": "adx_partner_status",
						"type": "INT32"
					},
					{
						"name": "adx_partnerprogram_status",
						"type": "INT32"
					},
					{
						"name": "adx_partnerhascapacity",
						"type": "BOOLEAN"
					},
					{
						"name": "adx_createdbyportalcontactid",
						"type": "UTF8"
					},
					{
						"name": "adx_createdbyportalcontactid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "adx_maximumopportunityrevenue_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "adx_minimumopportunityrevenue",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "adx_minimumopportunityrevenue_base",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "adx_maximumopportunityrevenue",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 4
					},
					{
						"name": "adx_lossrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_winrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_createdbyportalcontactidname",
						"type": "UTF8"
					},
					{
						"name": "adx_returnrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_numberofopportunitieswon",
						"type": "INT32"
					},
					{
						"name": "adx_averagetimetocloseanopportunity",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_partnerprogram_enddate",
						"type": "INT96"
					},
					{
						"name": "adx_partnerprogram_startdate",
						"type": "INT96"
					},
					{
						"name": "adx_feedbackrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_partnerranking",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_numberofopportunitiesdeclined",
						"type": "INT32"
					},
					{
						"name": "adx_touchrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "adx_activeopportunitycount",
						"type": "INT32"
					},
					{
						"name": "adx_numberofreturnedopportunities",
						"type": "INT32"
					},
					{
						"name": "adx_numberofopportunitieswithfeedback",
						"type": "INT32"
					},
					{
						"name": "adx_currentpartnercapacity",
						"type": "INT32"
					},
					{
						"name": "adx_numberofopportunitiesaccepted",
						"type": "INT32"
					},
					{
						"name": "adx_createdbyportalcontactidyominame",
						"type": "UTF8"
					},
					{
						"name": "adx_numberofopportunitiesdelivered",
						"type": "INT32"
					},
					{
						"name": "adx_stallrate",
						"type": "DECIMAL",
						"precision": 38,
						"scale": 2
					},
					{
						"name": "esi_lxpwelcomeletters",
						"type": "UTF8"
					},
					{
						"name": "esi_lxpwelcomeletters_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_membershipoffer",
						"type": "UTF8"
					},
					{
						"name": "esi_membershipoffer_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_membershipoffername",
						"type": "UTF8"
					},
					{
						"name": "esi_lxpwelcomelettersname",
						"type": "UTF8"
					},
					{
						"name": "esi_accountdisplayname",
						"type": "UTF8"
					},
					{
						"name": "esi_accesstype",
						"type": "BOOLEAN"
					},
					{
						"name": "esi_language",
						"type": "UTF8"
					},
					{
						"name": "esi_language_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_languagename",
						"type": "UTF8"
					},
					{
						"name": "esi_previousownerid",
						"type": "UTF8"
					},
					{
						"name": "esi_previousownerid_entitytype",
						"type": "UTF8"
					},
					{
						"name": "esi_lastassignmentdate",
						"type": "INT96"
					},
					{
						"name": "esi_previousowneridyominame",
						"type": "UTF8"
					},
					{
						"name": "esi_previousowneridname",
						"type": "UTF8"
					},
					{
						"name": "esi_cxpenableforreports",
						"type": "BOOLEAN"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_RAW_JSON')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DatasourceName": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().DatasourceName",
							"type": "Expression"
						},
						"fileSystem": "raw"
					}
				},
				"schema": {}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ADLS_RAW_PARQUET')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ADLS",
					"type": "LinkedServiceReference"
				},
				"parameters": {
					"DatabaseName": {
						"type": "string"
					},
					"FileName": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "Parquet",
				"typeProperties": {
					"location": {
						"type": "AzureBlobFSLocation",
						"fileName": {
							"value": "@dataset().FileName",
							"type": "Expression"
						},
						"folderPath": {
							"value": "@dataset().DatabaseName",
							"type": "Expression"
						},
						"fileSystem": "raw"
					},
					"compressionCodec": "snappy"
				},
				"schema": [
					{
						"name": "Agency",
						"type": "UTF8"
					},
					{
						"name": "Date",
						"type": "UTF8"
					},
					{
						"name": "EditStopExplanation",
						"type": "UTF8"
					},
					{
						"name": "EditStopOfficerId",
						"type": "UTF8"
					},
					{
						"name": "ExpYears",
						"type": "UTF8"
					},
					{
						"name": "IsEdited",
						"type": "BOOLEAN"
					},
					{
						"name": "IsPiiFound",
						"type": "BOOLEAN"
					},
					{
						"name": "OfficerId",
						"type": "UTF8"
					},
					{
						"name": "OfficerName",
						"type": "UTF8"
					},
					{
						"name": "Ori",
						"type": "UTF8"
					},
					{
						"name": "OverridePii",
						"type": "BOOLEAN"
					},
					{
						"name": "Status",
						"type": "UTF8"
					},
					{
						"name": "StopDateTime",
						"type": "UTF8"
					},
					{
						"name": "StopDuration",
						"type": "INT64"
					},
					{
						"name": "StopInResponseToCFS",
						"type": "BOOLEAN"
					},
					{
						"name": "Time",
						"type": "UTF8"
					},
					{
						"name": "_attachments",
						"type": "UTF8"
					},
					{
						"name": "_etag",
						"type": "UTF8"
					},
					{
						"name": "_rid",
						"type": "UTF8"
					},
					{
						"name": "_self",
						"type": "UTF8"
					},
					{
						"name": "_ts",
						"type": "INT64"
					},
					{
						"name": "id",
						"type": "UTF8"
					},
					{
						"name": "ListAgencyQuestion_Answer",
						"type": "UTF8"
					},
					{
						"name": "ListAgencyQuestion_Hint",
						"type": "UTF8"
					},
					{
						"name": "ListAgencyQuestion_MaxLength",
						"type": "INT64"
					},
					{
						"name": "ListAgencyQuestion_Name",
						"type": "UTF8"
					},
					{
						"name": "ListAgencyQuestion_Prompt",
						"type": "UTF8"
					},
					{
						"name": "ListAgencyQuestion_Required",
						"type": "BOOLEAN"
					},
					{
						"name": "ListAgencyQuestion_Type",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_BasisForSearchBrief",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_BasisForSearchPiiFound",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_GenderNonconforming",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_Id",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_IsStudent",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_PerceivedAge",
						"type": "INT64"
					},
					{
						"name": "ListPersonStopped_PerceivedGender",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_PerceivedLgbt",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_PerceivedLimitedEnglish",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_PersonSearchConsentGiven",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_PropertySearchConsentGiven",
						"type": "BOOLEAN"
					},
					{
						"name": "ListPersonStopped_ReasonForStopExplanation",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStopPiiFound",
						"type": "BOOLEAN"
					},
					{
						"name": "ListSubmission_DateSubmitted",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_FileName",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_Id",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_Status",
						"type": "UTF8"
					},
					{
						"name": "Location_BlockNumber",
						"type": "UTF8"
					},
					{
						"name": "Location_HighwayExit",
						"type": "UTF8"
					},
					{
						"name": "Location_Intersection",
						"type": "UTF8"
					},
					{
						"name": "Location_LandMark",
						"type": "UTF8"
					},
					{
						"name": "Location_OutOfCounty",
						"type": "BOOLEAN"
					},
					{
						"name": "Location_PiiFound",
						"type": "BOOLEAN"
					},
					{
						"name": "Location_School",
						"type": "BOOLEAN"
					},
					{
						"name": "Location_StreetName",
						"type": "UTF8"
					},
					{
						"name": "Location_ToggleLocationOptions",
						"type": "BOOLEAN"
					},
					{
						"name": "OfficerAssignment_Key",
						"type": "UTF8"
					},
					{
						"name": "OfficerAssignment_OtherType",
						"type": "UTF8"
					},
					{
						"name": "OfficerAssignment_Type",
						"type": "UTF8"
					},
					{
						"name": "PiiEntities_Category",
						"type": "UTF8"
					},
					{
						"name": "PiiEntities_ConfidenceScore",
						"type": "UTF8"
					},
					{
						"name": "PiiEntities_EntityText",
						"type": "UTF8"
					},
					{
						"name": "PiiEntities_Source",
						"type": "UTF8"
					},
					{
						"name": "telemetry_FormCached",
						"type": "BOOLEAN"
					},
					{
						"name": "telemetry_LookupCacheDate",
						"type": "UTF8"
					},
					{
						"name": "telemetry_Offline",
						"type": "BOOLEAN"
					},
					{
						"name": "telemetry_PullFromReasonCode",
						"type": "BOOLEAN"
					},
					{
						"name": "telemetry_Template",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListActionTakenDuringStop_Action",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListActionTakenDuringStop_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListBasisForPropertySeizure_Basis",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListBasisForPropertySeizure_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListBasisForSearch_Basis",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListBasisForSearch_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListContrabandOrEvidenceDiscovered_Contraband",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListContrabandOrEvidenceDiscovered_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListPerceivedOrKnownDisability_Disability",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListPerceivedOrKnownDisability_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListPerceivedRace_Key",
						"type": "INT64"
					},
					{
						"name": "ListPersonStopped_ListPerceivedRace_Race",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListResultOfStop_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListResultOfStop_Result",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListTypeOfPropertySeized_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListTypeOfPropertySeized_Type",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_Reason",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_Code",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_DateReported",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_ErrorType",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_FileName",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_Message",
						"type": "UTF8"
					},
					{
						"name": "ListSubmission_ListSubmissionError_SubmissionId",
						"type": "UTF8"
					},
					{
						"name": "Location_GeoLocation_Latitude",
						"type": "DOUBLE"
					},
					{
						"name": "Location_GeoLocation_Longitude",
						"type": "DOUBLE"
					},
					{
						"name": "telemetry_ListStepTrace_EndTimeStamp",
						"type": "UTF8"
					},
					{
						"name": "telemetry_ListStepTrace_Index",
						"type": "INT64"
					},
					{
						"name": "telemetry_ListStepTrace_StartTimeStamp",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListResultOfStop_ListCodes_Code",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ListResultOfStop_ListCodes_Text",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_ListCodes_Code",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_ListCodes_Text",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_ListDetail_Key",
						"type": "UTF8"
					},
					{
						"name": "ListPersonStopped_ReasonForStop_ListDetail_Reason",
						"type": "UTF8"
					},
					{
						"name": "Location_Beat_Codes_Code",
						"type": "UTF8"
					},
					{
						"name": "Location_Beat_Codes_Text",
						"type": "UTF8"
					},
					{
						"name": "Location_City_Codes_Code",
						"type": "UTF8"
					},
					{
						"name": "Location_City_Codes_Text",
						"type": "UTF8"
					},
					{
						"name": "Location_SchoolName_Codes_Code",
						"type": "UTF8"
					},
					{
						"name": "Location_SchoolName_Codes_Text",
						"type": "UTF8"
					}
				]
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ADLS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_ASQL_SQL_AUTH')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_ASQL_SQL_AUTH",
					"type": "LinkedServiceReference",
					"parameters": {
						"LS_ASQL_SQL_AUTH_CONN_SECRET": "sec-mdw-db-connection-string"
					}
				},
				"parameters": {
					"DS_ASQL_SQL_AUTH_CONN_SECRET": {
						"type": "String"
					},
					"DS_DB_SCHEMA_NAME": {
						"type": "String"
					},
					"DS_DB_TABLE_NAME": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlTable",
				"schema": [],
				"typeProperties": {
					"schema": {
						"value": "@dataset().DS_DB_SCHEMA_NAME",
						"type": "Expression"
					},
					"table": {
						"value": "@dataset().DS_DB_TABLE_NAME",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_ASQL_SQL_AUTH')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_COSMOSDB')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_COSMOSDB",
					"type": "LinkedServiceReference",
					"parameters": {
						"LS_COSMOS_DB_ACCT_URI": {
							"value": "@dataset().DS_COSMOS_DB_ACCT_URI",
							"type": "Expression"
						},
						"LS_COSMOS_ACCESS_KEY_SEC": {
							"value": "@dataset().DS_COSMOS_ACCESS_KEY_SEC",
							"type": "Expression"
						},
						"LS_COSMOS_DB_NAME": {
							"value": "@dataset().DS_COSMOS_DB_NAME",
							"type": "Expression"
						}
					}
				},
				"parameters": {
					"DS_DATABASETABLENAME": {
						"type": "string"
					},
					"DS_COSMOS_DB_ACCT_URI": {
						"type": "string"
					},
					"DS_COSMOS_ACCESS_KEY_SEC": {
						"type": "string"
					},
					"DS_COSMOS_DB_NAME": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "CosmosDbSqlApiCollection",
				"schema": {},
				"typeProperties": {
					"collectionName": {
						"value": "@dataset().DS_DATABASETABLENAME",
						"type": "Expression"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_COSMOSDB')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_ADB_SPARK_CLUSTER')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureDatabricks",
				"typeProperties": {
					"domain": "https://adb-5361235902374228.0.databricks.azure.us",
					"accessToken": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "LS_KEY_VAULT",
							"type": "LinkedServiceReference"
						},
						"secretName": "sec-databricks-access-token"
					},
					"existingClusterId": "[parameters('LS_ADB_SPARK_CLUSTER_properties_typeProperties_existingClusterId')]"
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_KEY_VAULT')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_ADLS')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "connection to dedevadatalake",
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('LS_ADLS_properties_typeProperties_url')]",
					"azureCloudType": "AzureUSGovernment",
					"tenant": "[parameters('LS_ADLS_properties_typeProperties_tenant')]",
					"servicePrincipalId": "[parameters('LS_ADLS_properties_typeProperties_servicePrincipalId')]",
					"servicePrincipalKey": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "LS_KEY_VAULT",
							"type": "LinkedServiceReference"
						},
						"secretName": "sec-spn-datalake-secret"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_KEY_VAULT')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_ASQL_SQL_AUTH')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"LS_ASQL_SQL_AUTH_CONN_SECRET": {
						"type": "string",
						"defaultValue": "sec-mdw-db-connection-string"
					}
				},
				"annotations": [],
				"type": "AzureSqlDatabase",
				"typeProperties": {
					"connectionString": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "LS_KEY_VAULT",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "[parameters('LS_ASQL_SQL_AUTH_properties_typeProperties_connectionString_secretName')]",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_KEY_VAULT')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_COSMOSDB')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"parameters": {
					"LS_COSMOS_DB_ACCT_URI": {
						"type": "string"
					},
					"LS_COSMOS_ACCESS_KEY_SEC": {
						"type": "string"
					},
					"LS_COSMOS_DB_NAME": {
						"type": "string"
					}
				},
				"annotations": [],
				"type": "CosmosDb",
				"typeProperties": {
					"connectionString": "[parameters('LS_COSMOSDB_connectionString')]",
					"accountKey": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "LS_KEY_VAULT",
							"type": "LinkedServiceReference"
						},
						"secretName": {
							"value": "@linkedService().LS_COSMOS_ACCESS_KEY_SEC",
							"type": "Expression"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_KEY_VAULT')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_DELTA_TABLE')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureDatabricksDeltaLake",
				"typeProperties": {
					"domain": "https://adb-5361235902374228.0.databricks.azure.us/",
					"clusterId": "0707-182743-y8rouvc6",
					"accessToken": {
						"type": "AzureKeyVaultSecret",
						"store": {
							"referenceName": "LS_KEY_VAULT",
							"type": "LinkedServiceReference"
						},
						"secretName": "sec-databricks-access-token"
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_KEY_VAULT')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_KEY_VAULT')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "AzureKeyVault",
				"typeProperties": {
					"baseUrl": "[parameters('LS_KEY_VAULT_properties_typeProperties_baseUrl')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/Update_AAS_Security_Readers')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Stopped",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_UPDATE_AAS_SECURITY_READERS",
							"type": "PipelineReference"
						},
						"parameters": {}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2022-06-22T17:05:00",
						"timeZone": "Pacific Standard Time",
						"schedule": {
							"minutes": [
								5
							],
							"hours": [
								5,
								7,
								9,
								11,
								13,
								15,
								17,
								19,
								21
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/PL_UPDATE_AAS_SECURITY_READERS')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/Daily Run')]",
			"type": "Microsoft.DataFactory/factories/triggers",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"runtimeState": "Started",
				"pipelines": [
					{
						"pipelineReference": {
							"referenceName": "PL_SOURCE_2_AAS",
							"type": "PipelineReference"
						},
						"parameters": {
							"EnableNotifications": "[parameters('Daily Run_properties_PL_SOURCE_2_AAS_parameters_EnableNotifications')]",
							"SendEmailNotificationAddress": "[parameters('Daily Run_properties_PL_SOURCE_2_AAS_parameters_SendEmailNotificationAddress')]"
						}
					}
				],
				"type": "ScheduleTrigger",
				"typeProperties": {
					"recurrence": {
						"frequency": "Day",
						"interval": 1,
						"startTime": "2021-10-05T19:06:00",
						"timeZone": "Pacific Standard Time",
						"schedule": {
							"minutes": [
								0
							],
							"hours": [
								19
							]
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/pipelines/PL_SOURCE_2_AAS')]"
			]
		}
	]
}